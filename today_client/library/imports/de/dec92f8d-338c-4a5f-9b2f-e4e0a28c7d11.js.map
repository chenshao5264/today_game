{"version":3,"sources":["assets/Script/net/socket_protobufjs.js"],"names":["protobufjs","require","msgid2proto","protos","roots","root_msgid","msgid","login","cc","Class","statics","load","key","url","raw","err","root","console","log","encode","rawMsg","protoMsg","lookupType","errMsg","verify","msg","create","buffer","finish","decode","bufferArray"],"mappings":";;;;;;AAAA,IAAIA,aAAaC,QAAQ,YAAR,CAAjB;AACA,IAAIC,cAAcD,QAAQ,YAAR,EAAsBC,WAAxC;;AAEA,IAAIC,SAAS;AACT,aAAS;AADA,CAAb;;AAIA,IAAIC,QAAQ,EAAZ;;AAEA,SAASC,UAAT,CAAoBC,KAApB,EAA2B;AACvB,QAAIA,SAAS,GAAT,IAAgBA,QAAQ,GAA5B,EAAiC;AAC7B,eAAOF,MAAMG,KAAb;AACH,KAFD,MAEO,CAEN;AACJ;;AAEDC,GAAGC,KAAH,CAAS;AACLC,aAAS;AACLC,cAAM,gBAAW;AACb,iBAAK,IAAIC,GAAT,IAAgBT,MAAhB,EAAwB;AACpBH,2BAAWW,IAAX,CAAgBH,GAAGK,GAAH,CAAOC,GAAP,CAAWX,OAAOS,GAAP,CAAX,CAAhB,EAAyC,UAASG,GAAT,EAAcC,IAAd,EAAoB;AACzD,wBAAID,GAAJ,EAAS;AACLE,gCAAQC,GAAR,CAAYH,GAAZ;AACA;AACH;;AAEDX,0BAAMQ,GAAN,IAAaI,IAAb;AACH,iBAPD;AAQH;AACJ,SAZI;AAaLG,gBAAQ,gBAASb,KAAT,EAAgBc,MAAhB,EAAwB;AAC5B,gBAAIC,WAAWhB,WAAWC,KAAX,EAAkBgB,UAAlB,CAA6BpB,YAAYI,KAAZ,CAA7B,CAAf;;AAEA,gBAAIiB,SAASF,SAASG,MAAT,CAAgBJ,MAAhB,CAAb;AACA,gBAAIG,MAAJ,EAAY;AACRN,wBAAQC,GAAR,CAAYK,MAAZ;AACA,uBAAO,EAAP;AACH;;AAED,gBAAIE,MAAMJ,SAASK,MAAT,CAAgBN,MAAhB,CAAV;AACA,gBAAIO,SAASN,SAASF,MAAT,CAAgBM,GAAhB,EAAqBG,MAArB,EAAb;;AAEA,mBAAOD,MAAP;AACH,SA1BI;AA2BLE,gBAAQ,gBAASvB,KAAT,EAAgBwB,WAAhB,EAA6B;AACjC,gBAAIT,WAAWhB,WAAWC,KAAX,EAAkBgB,UAAlB,CAA6BpB,YAAYI,KAAZ,CAA7B,CAAf;AACA,gBAAImB,MAAMJ,SAASQ,MAAT,CAAgBC,WAAhB,CAAV;AACA,mBAAOL,GAAP;AACH;AA/BI;AADJ,CAAT","file":"unknown","sourcesContent":["var protobufjs = require(\"protobufjs\");\nvar msgid2proto = require(\"./protocol\").msgid2proto;\n\nvar protos = {\n    \"login\": \"resources/proto/login.proto\"\n}\n\nvar roots = {}\n\nfunction root_msgid(msgid) {\n    if (msgid >= 100 && msgid < 500) {\n        return roots.login;\n    } else {\n\n    }\n} \n\ncc.Class({\n    statics: {\n        load: function() {\n            for (var key in protos) {\n                protobufjs.load(cc.url.raw(protos[key]), function(err, root) {\n                    if (err) {\n                        console.log(err);\n                        return;\n                    }\n\n                    roots[key] = root;\n                }) \n            }\n        },\n        encode: function(msgid, rawMsg) {\n            var protoMsg = root_msgid(msgid).lookupType(msgid2proto[msgid]);\n\n            var errMsg = protoMsg.verify(rawMsg);\n            if (errMsg) {\n                console.log(errMsg);\n                return [];\n            }\n\n            var msg = protoMsg.create(rawMsg);\n            var buffer = protoMsg.encode(msg).finish();\n\n            return buffer;\n        },\n        decode: function(msgid, bufferArray) {\n            var protoMsg = root_msgid(msgid).lookupType(msgid2proto[msgid]);\n            var msg = protoMsg.decode(bufferArray);\n            return msg;\n        }\n    }\n});\n"]}